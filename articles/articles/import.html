<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Import into other packages • vegawidget</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../extra.css" rel="stylesheet">
<meta property="og:title" content="Import into other packages">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">vegawidget</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/vegawidget.html">Getting Started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/vegaspec.html">Specify using vegaspec</a>
    </li>
    <li>
      <a href="../../articles/articles/render-vegawidget.html">Render using vegawidget</a>
    </li>
    <li>
      <a href="../../articles/articles/shiny.html">Extend using Shiny</a>
    </li>
    <li>
      <a href="../../articles/articles/javascript.html">Extend using JavaScript</a>
    </li>
    <li>
      <a href="../../articles/articles/image.html">Create Images</a>
    </li>
    <li>
      <a href="../../articles/articles/dates-times.html">Work with Dates and Times</a>
    </li>
    <li>
      <a href="../../articles/articles/import.html">Import into Other Packages</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/vegawidget/vegawidget">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Import into other packages</h1>
            
            <h4 class="date">2020-01-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/vegawidget/vegawidget/blob/master/vignettes/articles/import.Rmd"><code>vignettes/articles/import.Rmd</code></a></small>
      <div class="hidden name"><code>import.Rmd</code></div>

    </div>

    
    
<p>The <strong>vegawidget</strong> package is designed to be a low-level interface to the Vega and Vega-Lite visualization frameworks. As such, we hope that the functions provided here can serve as a foundation for other, presumably higher-level, packages. To make it easier for authors of such packages, we offer a function <code><a href="../../reference/use_vegawidget.html">use_vegawidget()</a></code> to help incorporate vegawidget functions.</p>
<p>You can use <code><a href="../../reference/use_vegawidget.html">use_vegawidget()</a></code> to import and re-export from vegawidget:</p>
<ul>
<li>local versions of: <code><a href="../../reference/as_vegaspec.html">as_vegaspec()</a></code>, <code><a href="https://rdrr.io/r/base/print.html">print()</a></code>, <code><a href="https://rdrr.io/r/base/format.html">format()</a></code>, <code>knit_print()</code>
</li>
<li>
<code><a href="../../reference/vw_as_json.html">vw_as_json()</a></code><br>
</li>
<li><code><a href="../../reference/vegawidget.html">vegawidget()</a></code></li>
<li><code><a href="../../reference/vega_embed.html">vega_embed()</a></code></li>
<li>image functions: <code><a href="../../reference/image.html">vw_to_svg()</a></code>, <code><a href="../../reference/image.html">vw_to_bitmap()</a></code>, <code><a href="../../reference/image.html">vw_write_svg()</a></code>, <code><a href="../../reference/image.html">vw_write_png()</a></code>
</li>
<li>sample spec: <code>spec_mtcars</code>
</li>
<li>basic Shiny-rendering functions: <code><a href="../../reference/renderVegawidget.html">renderVegawidget()</a></code>, <code><a href="../../reference/vegawidgetOutput.html">vegawidgetOutput()</a></code>
</li>
</ul>
<p>If you implement an S3 class in your package, you can call <code><a href="../../reference/use_vegawidget.html">use_vegawidget()</a></code> with the name of your class. This will add more boilerplate code; you will have to provide the code to convert from your class to a <code>vegaspec</code>.</p>
<p>If you want to re-export vegawidget’s interactivity functions, you can then use <code><a href="../../reference/use_vegawidget.html">use_vegawidget_interactive()</a></code> to import and re-export:</p>
<ul>
<li>JavaScript listeners: <code><a href="../../reference/add-listeners.html">vw_add_data_listener()</a></code>, <code><a href="../../reference/add-listeners.html">vw_add_signal_listener()</a></code> <code><a href="../../reference/add-listeners.html">vw_add_event_listener()</a></code>
</li>
<li>JavaScript handlers: <code><a href="../../reference/vw_handler_signal.html">vw_handler_data()</a></code>, <code><a href="../../reference/vw_handler_signal.html">vw_handler_signal()</a></code>, <code><a href="../../reference/vw_handler_signal.html">vw_handler_event()</a></code>, <code><a href="../../reference/vw_handler_add_effect.html">vw_handler_add_effect()</a></code>
</li>
<li>Shiny getters (reactives): <code><a href="../../reference/shiny-getters.html">vw_shiny_get_data()</a></code>, <code><a href="../../reference/shiny-getters.html">vw_shiny_get_signal()</a></code>, <code><a href="../../reference/shiny-getters.html">vw_shiny_get_event()</a></code>
</li>
<li>Shiny setters (observers): <code><a href="../../reference/shiny-setters.html">vw_shiny_set_data()</a></code>, <code><a href="../../reference/shiny-setters.html">vw_shiny_set_signal()</a></code>
</li>
</ul>
<div id="example-altair" class="section level2">
<h2 class="hasAnchor">
<a href="#example-altair" class="anchor"></a>Example: altair</h2>
<p>For example, the <a href="https://vegawidget.github.io/altair"><strong>altair</strong></a> package provides an R interface to the <a href="https://altair-viz.github.io"><strong>Altair</strong></a> Python package. The altair package itself provides the connection to Python, using <a href="https://rstudio.github.io/reticulate"><strong>reticulate</strong></a>; altair’s focus is to provide a means to build a Vega-Lite specification - using higher-level abstractions than lists.</p>
<p>The rendering part of altair is handled by the vegawidget package. A number of vegawidget functions are imported into altair, then re-exported. From altair’s perspective, this import-export operation is handled by a single vegawidget function: <code><a href="../../reference/use_vegawidget.html">use_vegawidget()</a></code>.</p>
<div id="inspiration-usethisuse_pipe" class="section level3">
<h3 class="hasAnchor">
<a href="#inspiration-usethisuse_pipe" class="anchor"></a>Inspiration: <code>usethis::use_pipe()</code>
</h3>
<p>A lot of packages use the pipe (<code><a href="../../reference/pipe.html">%&gt;%</a></code>) function, so much so that the <a href="http://usethis.r-lib.org"><strong>usethis</strong></a> package offers the function <code><a href="https://usethis.r-lib.org/reference/use_pipe.html">usethis::use_pipe()</a></code> for package authors to make the pipe part of their package’s offer:</p>
<ul>
<li>adds the <strong>magrittr</strong> package to the “Imports” section of the package’s DESCRIPTION file</li>
<li>creates a new file in the package’s <code>R</code> directory, <code>utils-pipe.R</code>
</li>
</ul>
<p>This new file contains roxygen directives that will handle the importing and exporting the next time you build the package’s documentation. Now, people who install this package will have access to the pipe operator without having to refer explicitly to the magrittr package. It “just works”.</p>
</div>
<div id="implementation" class="section level3">
<h3 class="hasAnchor">
<a href="#implementation" class="anchor"></a>Implementation</h3>
<p>We wish to bring a similar robustness and ease-of-use to package authors who want to incorporate vegawidget. To demonstrate how to do this, we will show the process we use for altair.</p>
<p>The <code><a href="../../reference/use_vegawidget.html">use_vegawidget()</a></code> function makes a couple of related assumptions about your package. It assumes that your package builds Vega and Vega-Lite specifications, and that the object that you use to contain a specification may be an object with an S3 class. In the case of altair, the name of this S3 class is <code>"altair.vegalite.v3.api.TopLevelMixin"</code>.</p>
<p>The first step is generic. In your package-project, your R working directory is the package’s root directory. When you run <code><a href="../../reference/use_vegawidget.html">use_vegawidget()</a></code>, you can provide the name of the S3 class. In the case of altair, we run:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">vegawidget<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/vegawidget/man/use_vegawidget.html">use_vegawidget</a></span>(<span class="st">"altair.vegalite.v3.api.TopLevelMixin"</span>)</a></code></pre></div>
<p>Like the <code><a href="https://usethis.r-lib.org/reference/use_pipe.html">usethis::use_pipe()</a></code> example, this call does two things:</p>
<ul>
<li>adds the <strong>vegawidget</strong> package to the “Imports” section of the package’s DESCRIPTION file</li>
<li>creates new files in the package’s <code>R</code> directory, <code>utils-vegawidget.R</code> and <code>utils-vegawidget-altair.vegalite.v3.api.TopLevelMixin.R</code>.</li>
</ul>
<p>However, you have a little bit more work to do before you’re done. You need to edit your new copy of <code>utils-vegawidget-altair.vegalite.v3.api.TopLevelMixin</code> to tell it how to convert your S3 class to a <code>vegaspec</code>. The part of the file that you need to edit is at the very top.</p>
<p>In the case of altair, the name of the function is <code>as_vegaspec.altair.vegalite.v3.api.TopLevelMixin()</code>; the <code><a href="../../reference/use_vegawidget.html">use_vegawidget()</a></code> function has already named it using the class-name provided.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">as_vegaspec.altair.vegalite.v3.api.TopLevelMixin &lt;-<span class="st"> </span><span class="cf">function</span>(spec, ...) {</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="co"># </span><span class="al">TODO</span><span class="co">: if needed, insert code to convert your object to</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="co"># something that can be coerced to a vegaspec.</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  <span class="co">#</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  <span class="co"># e.g.:</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  <span class="co"># spec &lt;- spec$to_json()</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">  vegawidget<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/vegawidget/man/as_vegaspec.html">as_vegaspec</a></span>(spec, ...)</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">}</a></code></pre></div>
<p>Here, the commented example code is exactly what is needed. The altair “chart” object, <code>altair.vegalite.v3.api.TopLevelMixin</code>, has a method, <code>to_json()</code> to write out the specification to JSON. The vegawidget <code><a href="../../reference/as_vegaspec.html">as_vegaspec()</a></code> generic has a method for JSON-formatted strings (it also has a method for lists). So our “finished” product looks like:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">as_vegaspec.altair.vegalite.v3.api.TopLevelMixin &lt;-<span class="st"> </span><span class="cf">function</span>(spec, ...) {</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  spec &lt;-<span class="st"> </span>spec<span class="op">$</span><span class="kw">to_json</span>()</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">  vegawidget<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/vegawidget/man/as_vegaspec.html">as_vegaspec</a></span>(spec, ...)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">}</a></code></pre></div>
<p>At this point, once you document and re-build the package, vegawidget is fully integrated into it.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#example-altair">Example: altair</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ian Lyttle, Vega/Vega-Lite Developers.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
