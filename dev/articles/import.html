<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Import into other packages • vegawidget</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Import into other packages">
<meta property="og:description" content="vegawidget">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vegawidget</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.4.3.9004</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/vegawidget.html">Getting Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vegaspec.html">Specify using vegaspec</a>
    </li>
    <li>
      <a href="../articles/render-vegawidget.html">Render using vegawidget</a>
    </li>
    <li>
      <a href="../articles/shiny.html">Extend using Shiny</a>
    </li>
    <li>
      <a href="../articles/javascript.html">Extend using JavaScript</a>
    </li>
    <li>
      <a href="../articles/image.html">Create Images</a>
    </li>
    <li>
      <a href="../articles/dates-times.html">Work with Dates and Times</a>
    </li>
    <li>
      <a href="../articles/import.html">Import into Other Packages</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/vegawidget/vegawidget" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Import into other packages</h1>
            
            <h4 data-toc-skip class="date">2024-01-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/vegawidget/vegawidget/blob/HEAD/vignettes/articles/import.Rmd" class="external-link"><code>vignettes/articles/import.Rmd</code></a></small>
      <div class="hidden name"><code>import.Rmd</code></div>

    </div>

    
    
<p>The <strong>vegawidget</strong> package is designed to be a low-level
interface to the Vega and Vega-Lite visualization frameworks. As such,
we hope that the functions provided here can serve as a foundation for
other, presumably higher-level, packages. To make it easier for authors
of such packages, we offer a function <code><a href="../reference/use_vegawidget.html">use_vegawidget()</a></code> to
help incorporate vegawidget functions.</p>
<p>You can use <code><a href="../reference/use_vegawidget.html">use_vegawidget()</a></code> to import and re-export
from vegawidget:</p>
<ul>
<li>local versions of: <code><a href="../reference/as_vegaspec.html">as_vegaspec()</a></code>, <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>,
<code><a href="https://rdrr.io/r/base/format.html" class="external-link">format()</a></code>, <code>knit_print()</code>
</li>
<li>
<code><a href="../reference/vw_as_json.html">vw_as_json()</a></code><br>
</li>
<li>
<code><a href="../reference/vegawidget.html">vegawidget()</a></code>, <code><a href="../reference/vega_embed.html">vega_embed()</a></code>,
<code><a href="../reference/vw_set_base_url.html">vw_set_base_url()</a></code>
</li>
<li>image functions: <code><a href="../reference/image.html">vw_to_svg()</a></code>,
<code><a href="../reference/image.html">vw_to_bitmap()</a></code>, <code><a href="../reference/image.html">vw_write_svg()</a></code>,
<code><a href="../reference/image.html">vw_write_png()</a></code>
</li>
<li>basic Shiny-rendering functions: <code><a href="../reference/renderVegawidget.html">renderVegawidget()</a></code>,
<code><a href="../reference/vegawidgetOutput.html">vegawidgetOutput()</a></code>
</li>
</ul>
<p>If you implement an S3 class in your package, you can call
<code><a href="../reference/use_vegawidget.html">use_vegawidget()</a></code> with the name of your class. This will add
more boilerplate code; you will have to provide the code to convert from
your class to a <code>vegaspec</code>.</p>
<p>If you want to re-export vegawidget’s interactivity functions, you
can then use <code><a href="../reference/use_vegawidget.html">use_vegawidget_interactive()</a></code> to import and
re-export:</p>
<ul>
<li>JavaScript listeners: <code><a href="../reference/add-listeners.html">vw_add_data_listener()</a></code>,
<code><a href="../reference/add-listeners.html">vw_add_signal_listener()</a></code>
<code><a href="../reference/add-listeners.html">vw_add_event_listener()</a></code>
</li>
<li>JavaScript handlers: <code><a href="../reference/vw_handler_signal.html">vw_handler_data()</a></code>,
<code><a href="../reference/vw_handler_signal.html">vw_handler_signal()</a></code>, <code><a href="../reference/vw_handler_signal.html">vw_handler_event()</a></code>,
<code><a href="../reference/vw_handler_add_effect.html">vw_handler_add_effect()</a></code>
</li>
<li>Shiny getters (reactives): <code><a href="../reference/shiny-getters.html">vw_shiny_get_data()</a></code>,
<code><a href="../reference/shiny-getters.html">vw_shiny_get_signal()</a></code>,
<code><a href="../reference/shiny-getters.html">vw_shiny_get_event()</a></code>
</li>
<li>Shiny setters (observers): <code><a href="../reference/shiny-setters.html">vw_shiny_set_data()</a></code>,
<code><a href="../reference/shiny-setters.html">vw_shiny_set_signal()</a></code>
</li>
</ul>
<p>For example, the <a href="https://vegawidget.github.io/altair" class="external-link"><strong>altair</strong></a>
package provides an R interface to the <a href="https://altair-viz.github.io" class="external-link"><strong>Altair</strong></a> Python
package. The altair package itself provides the connection to Python,
using <a href="https://rstudio.github.io/reticulate" class="external-link"><strong>reticulate</strong></a>;
altair’s focus is to provide a means to build a Vega-Lite specification
- using higher-level abstractions than lists.</p>
<p>The rendering part of altair is handled by the vegawidget package. A
number of vegawidget functions are imported into altair, then
re-exported. From altair’s perspective, this import-export operation is
handled by a single vegawidget function:
<code><a href="../reference/use_vegawidget.html">use_vegawidget()</a></code>.</p>
<div class="section level2">
<h2 id="inspiration">Inspiration<a class="anchor" aria-label="anchor" href="#inspiration"></a>
</h2>
<p>A lot of packages use the pipe (<code>%&gt;%</code>) function, so
much so that the <a href="http://usethis.r-lib.org" class="external-link"><strong>usethis</strong></a> package
offers the function <code><a href="https://usethis.r-lib.org/reference/use_pipe.html" class="external-link">usethis::use_pipe()</a></code> for package authors
to make the pipe part of their package’s offer:</p>
<ul>
<li>adds the <strong>magrittr</strong> package to the “Imports” section
of the package’s DESCRIPTION file</li>
<li>creates a new file in the package’s <code>R</code> directory,
<code>utils-pipe.R</code>
</li>
</ul>
<p>This new file contains roxygen directives that will handle the
importing and exporting the next time you build the package’s
documentation. Now, people who install this package will have access to
the pipe operator without having to refer explicitly to the magrittr
package. It “just works”.</p>
</div>
<div class="section level2">
<h2 id="implementation">Implementation<a class="anchor" aria-label="anchor" href="#implementation"></a>
</h2>
<p>We wish to bring a similar robustness and ease-of-use to package
authors who want to incorporate vegawidget. To demonstrate how to do
this, we will show the process we use for altair.</p>
<p>The <code><a href="../reference/use_vegawidget.html">use_vegawidget()</a></code> function makes a couple of related
assumptions about your package. It assumes that your package builds Vega
and Vega-Lite specifications, and that the object that you use to
contain a specification may be an object with an S3 class. In the case
of altair, the name of this S3 class is
<code>"altair.vegalite.v4.api.TopLevelMixin"</code>.</p>
<p>The first step is generic. In your package-project, your R working
directory is the package’s root directory. When you run
<code><a href="../reference/use_vegawidget.html">use_vegawidget()</a></code>, you can provide the name of the S3 class.
In the case of altair, we run:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">vegawidget</span><span class="fu">::</span><span class="fu"><a href="../reference/use_vegawidget.html">use_vegawidget</a></span><span class="op">(</span><span class="st">"altair.vegalite.v4.api.TopLevelMixin"</span><span class="op">)</span></span></code></pre></div>
<p>Like the <code><a href="https://usethis.r-lib.org/reference/use_pipe.html" class="external-link">usethis::use_pipe()</a></code> example, this call does two
things:</p>
<ul>
<li>adds the <strong>vegawidget</strong> package to the “Imports”
section of the package’s DESCRIPTION file</li>
<li>creates new files in the package’s <code>R</code> directory,
<code>utils-vegawidget.R</code> and
<code>utils-vegawidget-altair.vegalite.v4.api.TopLevelMixin.R</code>.</li>
</ul>
<p>However, you have a little bit more work to do before you’re done.
You need to edit your new copy of
<code>utils-vegawidget-altair.vegalite.v4.api.TopLevelMixin</code> to
tell it how to convert your S3 class to a <code>vegaspec</code>. The
part of the file that you need to edit is at the very top.</p>
<p>In the case of altair, the name of the function is
<code>as_vegaspec.altair.vegalite.v4.api.TopLevelMixin()</code>; the
<code><a href="../reference/use_vegawidget.html">use_vegawidget()</a></code> function has already named it using the
class-name provided.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">as_vegaspec.altair.vegalite.v4.api.TopLevelMixin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">spec</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># TODO: if needed, insert code to convert your object to</span></span>
<span>  <span class="co"># something that can be coerced to a vegaspec.</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># e.g.:</span></span>
<span>  <span class="co"># spec &lt;- spec$to_json()</span></span>
<span></span>
<span>  <span class="fu">vegawidget</span><span class="fu">::</span><span class="fu"><a href="../reference/as_vegaspec.html">as_vegaspec</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Here, the commented example code is exactly what is needed. The
altair “chart” object,
<code>altair.vegalite.v4.api.TopLevelMixin</code>, has a method,
<code>to_json()</code> to write out the specification to JSON. The
vegawidget <code><a href="../reference/as_vegaspec.html">as_vegaspec()</a></code> generic has a method for
JSON-formatted strings (it also has a method for lists). So our
“finished” product looks like:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">as_vegaspec.altair.vegalite.v4.api.TopLevelMixin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">spec</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">spec</span> <span class="op">&lt;-</span> <span class="va">spec</span><span class="op">$</span><span class="fu">to_json</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">vegawidget</span><span class="fu">::</span><span class="fu"><a href="../reference/as_vegaspec.html">as_vegaspec</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>One last thing, to enable knit-printing of your class, you should
have some code like this in an <code>.onLoad()</code> function, usually
kept in a file called <code>zzz.R</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">.onLoad</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">libname</span>, <span class="va">pkgname</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># you might have other code here, too</span></span>
<span></span>
<span>  <span class="fu">vegawidget</span><span class="fu">::</span><span class="fu"><a href="../reference/s3_register.html">s3_register</a></span><span class="op">(</span></span>
<span>    <span class="st">"knitr::knit_print"</span>,</span>
<span>    <span class="st">"altair.vegalite.v4.api.TopLevelMixin"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The function <code><a href="../reference/s3_register.html">vegawidget::s3_register()</a></code> is copied from
<code><a href="https://vctrs.r-lib.org/reference/s3_register.html" class="external-link">vctrs::s3_register()</a></code>; for more details please see its <a href="https://vctrs.r-lib.org/reference/s3_register.html" class="external-link">documentation</a>.</p>
<p>At this point, once you document and re-build the package, vegawidget
is fully integrated into it.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Ian Lyttle, Vega/Vega-Lite Developers.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
